---
description: ソースコードと設計書の差異を抽出し、整合性を確保する
---

# 実装と設計の比較

**引数:** (任意) 対象の設計書パス または ソースコードディレクトリ (例: `/compare-implementation-design docs/functional-design.md`)
引数がない場合は、プロジェクト全体の主要な設計書とソースコードを比較します。

## 実行方法

```bash
claude
> /compare-implementation-design [パス]
```

## 手順

### ステップ1: 対象の特定と読み込み

1. 引数で指定されたパス、またはデフォルトの対象（`docs/`配下の設計書と`key-management-service/`配下のソースコード）を特定します。
2. 以下の主要な設計書を読み込みます：
    - `docs/functional-design.md`
    - `docs/architecture.md`
    - `docs/api/openapi.yaml` (存在する場合)
    - 指定された設計書
3. 関連するソースコード構造を`ls -R`や`glob`で把握し、主要な実装ファイルを読み込みます。

### ステップ2: 差異分析

設計書に記述された仕様（APIエンドポイント、データ構造、クラス/関数設計、振る舞い）と、実際のソースコード実装を比較します。

以下の観点で差異を抽出します：
1. **未実装の機能:** 設計にあるがコードにないもの。
2. **設計外の実装:** コードにあるが設計にないもの。
3. **仕様の不一致:** パラメータ、型、ロジックなどが異なるもの。

### ステップ3: 差異の報告と確認

抽出された差異をリストアップし、ユーザーに報告します。
各差異について、以下のどちらの方針で対応するかをユーザーに確認します：

- **A: ソースコードを修正** (実装が誤っている、または古い場合)
- **B: 設計書を修正** (実装が正しく、設計書が更新されていない場合)
- **C: 無視/保留** (意図的な差異である場合)

### ステップ4: 整合性の確保（修正実行）

ユーザーの指示に従い、各差異について修正を実行します。

- **ソースコードの修正:** 必要なコード変更を行い、テストを実行して動作を確認します。
- **設計書の修正:** 設計書を現状の実装に合わせて更新します。

### ステップ5: 最終確認

全ての差異について対応が完了したことを確認し、最終的な整合性レポートを出力します。

